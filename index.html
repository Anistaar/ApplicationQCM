<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Text2Quiz (Vite)</title>

    <style>
      :root{
        --bg:#0b0f14; --fg:#e8eaed; --muted:#9aa4af; --brd:#22303c;
        --ok-bg:#123d28; --ok-brd:#1f6b45; --ok-fg:#adf0c0;
        --ko-bg:#3a1517; --ko-brd:#5a2225; --ko-fg:#f9b3b6;
        --warn-bg:#2a2417; --warn-brd:#4b4130;
        --primary:#e8eaed; --accent:#84cc16;
      }
      html[data-theme="light"]{
        --bg:#ffffff; --fg:#111; --muted:#6b7280; --brd:#e5e7eb;
        --ok-bg:#eafaf0; --ok-brd:#b4e4c7; --ok-fg:#14532d;
        --ko-bg:#fef2f2; --ko-brd:#f5c2c7; --ko-fg:#7f1d1d;
        --warn-bg:#fff8f0; --warn-brd:#f3d5b0;
        --primary:#111; --accent:#2563eb;
      }

      *{box-sizing:border-box}
      html,body{height:100%}
      body{margin:0;background:var(--bg);color:var(--fg);
        font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

  .wrap{max-width:1200px;margin:0 auto;padding:0 18px 32px}

      /* topbar */
      .topbar{position:sticky; top:0; z-index:50; background:var(--bg);
        border-bottom:1px solid var(--brd); display:flex; gap:12px;
        align-items:center; justify-content:space-between; padding:10px 0}
      /* barre active (session) */
      .active-toolbar{position:sticky; top:0; z-index:49; background:linear-gradient(180deg, rgba(0,0,0,0.06), rgba(0,0,0,0));
        border-bottom:1px solid var(--brd); display:flex; align-items:center; justify-content:space-between;
        gap:12px; padding:8px 0; backdrop-filter:saturate(140%) blur(2px)}
      .active-toolbar .crumb{font-weight:700}
      .app-mode-active #active-toolbar{display:flex !important}

      h1{margin:0; font-size:20px}
      .subtitle{margin:6px 0 12px; color:var(--muted); font-size:14px}
      .theme-toggle{display:flex; align-items:center; gap:8px; font-weight:600}
      .theme-toggle input{transform:scale(1.1)}

      /* panneau options */
      .card{border:1px solid var(--brd); border-radius:12px; background:transparent;
        padding:12px; margin:10px 0}

      /* Explorer compact styles */
      .fb-folder{padding:6px 8px; border-radius:6px; margin-bottom:4px}
      .fb-folder.active{background:rgba(255,255,255,0.03)}
      .fb-file{display:flex; align-items:center; justify-content:space-between; padding:8px 10px; border-radius:8px}
      .fb-file .label{flex:1}
      .fb-file .controls{display:flex; gap:8px; align-items:center}
      .fb-toolbar{display:flex; gap:8px; align-items:center; margin-bottom:6px}
      .fb-toolbar select, .fb-file select{padding:6px 8px; border-radius:6px}
      .row{display:grid; gap:6px; margin-bottom:10px}
      label{font-weight:600; font-size:14px}
      select,input{padding:10px 12px; border-radius:10px; border:1px solid var(--brd);
        background:transparent; color:var(--fg); font-size:14px; transition:box-shadow .15s, border-color .15s}
      select:focus, input:focus{outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(132,204,22,0.25)}
      select option{background:var(--bg); color:var(--fg)}
      .modes{display:flex; gap:14px}

      /* boutons */
  .primary,.secondary{padding:10px 14px; border-radius:10px; cursor:pointer; font-size:14px; transition:all .15s ease}
  .primary{border:1px solid var(--accent); background:var(--accent); color:var(--bg)}
  .primary:hover{filter:brightness(1.08)}
  .primary:disabled{opacity:.6; cursor:not-allowed}
  .secondary{border:1px solid var(--brd); background:transparent; color:var(--fg)}
  .secondary:hover{border-color:var(--accent); color:var(--accent)}

      /* checkboxes pour cours multiples */
      .cours-checkbox-item {
        display: flex; align-items: center; gap: 8px; padding: 4px 6px; 
        border-radius: 6px; margin-bottom: 2px;
      }
      .cours-checkbox-item:hover {
        background: rgba(255,255,255,0.05);
      }
      .cours-checkbox-item input[type="checkbox"] {
        transform: scale(1.1);
      }
      .cours-checkbox-item .folder-tag {
        font-size: 11px; color: var(--muted); 
        background: rgba(255,255,255,0.1); padding: 1px 4px; 
        border-radius: 3px; margin-left: auto;
      }

      /* ent√™te quiz + barre */
      .head{display:flex; gap:10px; justify-content:space-between; flex-wrap:wrap; margin:8px 0}
      .badge{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--brd);
        font-size:12px; color:var(--muted)}
      .progress{height:8px; background:transparent; border-radius:999px; border:1px solid var(--brd); overflow:hidden}
      .progress__bar{height:100%; background:var(--accent); transition:width .2s ease}

      /* carte question compacte */
      .card--q{position:relative; border:1px solid var(--brd); border-radius:12px; background:transparent;
        padding:12px; margin:10px 0; max-height:62vh; overflow:auto; scroll-behavior:smooth}
      .qtitle{font-weight:800; margin:0 0 6px 0}
      .block{margin:8px 0}
      .hint{margin-top:4px}
      small.muted{color:var(--muted)}

      /* options grille */
      .options{display:grid; gap:8px; margin:10px 0}
      @media (min-width:768px){ .options{grid-template-columns:repeat(2,minmax(0,1fr))} }
      .options--inline{grid-template-columns:none; grid-auto-flow:column; justify-content:start}

      .opt{display:flex; gap:8px; align-items:center; padding:8px 10px;
        border:1px solid var(--brd); border-radius:10px; transition:.15s}
      .opt input{transform:scale(1.05); margin-top:1px}
      .opt.good{background:var(--ok-bg); border-color:var(--ok-brd)}
      .opt.bad{background:var(--ko-bg); border-color:var(--ko-brd)}
      .opt .label{flex:1}
      .mark{margin-left:auto; font-weight:800}
      .mark--good{color:var(--ok-fg)}
      .mark--bad{color:var(--ko-fg)}

      /* feedback repliable */
      .feedback{margin-top:8px; border-radius:10px; padding:8px}
      .feedback.ok{background:var(--ok-bg); border:1px solid var(--ok-brd)}
      .feedback.ko{background:var(--ko-bg); border:1px solid var(--ko-brd)}
      details.feedback > summary{cursor:pointer; list-style:none; font-weight:700}
      details.feedback > summary::-webkit-details-marker{display:none}

      /* bouton suivant flottant */
      .fab-next{position:fixed; right:18px; bottom:18px; z-index:60; border-radius:999px;
        padding:10px 14px; font-weight:700; border:1px solid var(--primary); background:var(--primary);
        color:var(--bg); box-shadow:0 6px 30px rgba(0,0,0,.25); cursor:pointer}
      .fab-next:disabled{opacity:.6; cursor:not-allowed}

      /* r√©sultats */
      .list{display:grid; gap:8px; padding-left:18px}
      .list li{list-style:decimal; border:1px solid var(--brd); border-radius:12px; padding:10px}
      .list li.ok{background:var(--ok-bg); border-color:var(--ok-brd)}
      .list li.ko{background:var(--warn-bg); border-color:var(--warn-brd)}

      /* drag and drop */
      .drag-container{margin-top:16px}
      .drag-items{display:grid; gap:12px; margin-bottom:16px}
      .drag-item-row{display:grid; grid-template-columns:1fr 2fr auto; gap:12px; align-items:center}
      .drag-item-row.correct{background:var(--ok-bg); border-radius:8px; padding:8px}
      .drag-item-row.incorrect{background:var(--ko-bg); border-radius:8px; padding:8px}
      .drag-item-label{font-weight:600; padding:8px}
      .drag-drop-zone{min-height:40px; border:2px dashed var(--brd); border-radius:8px; padding:4px;
        display:flex; align-items:center; justify-content:center; transition:all 0.2s}
      .drag-drop-zone.drag-over{border-color:var(--accent); background:rgba(132,204,22,0.1)}
      .drag-drop-zone .placeholder{color:var(--muted); font-size:13px}
      .drag-match-chip{display:inline-block; padding:6px 12px; background:var(--accent); color:var(--bg);
        border-radius:6px; cursor:grab; user-select:none; font-size:14px}
      .drag-match-chip:active{cursor:grabbing}
      .drag-match-chip.dragging{opacity:0.5}
      .drag-match-chip.used{opacity:0.4}
      .drag-matches-pool{margin-top:16px; padding:12px; border:1px solid var(--brd); border-radius:8px}
      .pool-label{font-weight:600; margin-bottom:8px; font-size:14px}
      .drag-matches{display:flex; flex-wrap:wrap; gap:8px}
      .correct-answer{color:var(--ok-fg); font-weight:600; font-size:13px}

      /* flashcards */
      .flash-wrap{display:flex; flex-direction:column; gap:12px}
      .flashcard{border:1px solid var(--brd); border-radius:12px; padding:16px; min-height:160px; display:flex; align-items:center; justify-content:center; text-align:center}
      .flash-q{font-weight:700;}
      .flash-a{color:var(--accent); font-weight:600}
      .flash-actions{display:flex; gap:8px; justify-content:center}
      .flash-actions .primary{min-width:120px}
      .flash-toolbar{display:flex; justify-content:space-between; align-items:center}

      /* match mode */
      .match-toolbar{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
      .match-grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(140px, 1fr)); gap:10px}
      .match-card{border:1px solid var(--brd); border-radius:10px; padding:12px; cursor:pointer; text-align:center; user-select:none}
      .match-card.selected{outline:2px solid var(--accent)}
      .match-card.matched{opacity:0.3; pointer-events:none}

  /* Mode actif: cacher la zone de s√©lection et plan */
      .app-mode-active #selection-area, .app-mode-active #plan-card { display:none !important; }
      .app-mode-active .topbar #btn-explorer { display:none !important; }
      .app-mode-active .subtitle { display:none !important; }
      /* Single column layout by design */

  /* Stats cards layout (mati√®re & cours) */
  .folder-stats-grid{display:grid; gap:6px; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr))}
  .folder-stats-grid .stat{border:1px solid var(--brd); border-radius:10px; padding:8px; display:flex; flex-direction:column; gap:2px; background:rgba(255,255,255,0.01)}
  .folder-stats-grid .label{font-size:11px; color:var(--muted)}
  .folder-stats-grid .value{font-weight:800; line-height:1.1}
      .badge.ok{background:var(--ok-bg); border-color:var(--ok-brd); color:var(--ok-fg)}
      .badge.warn{background:var(--warn-bg); border-color:var(--warn-brd); color:#b45309}
      .badge.danger{background:var(--ko-bg); border-color:var(--ko-brd); color:var(--ko-fg)}
      .course-card-disabled{opacity:.6; filter:saturate(.8);}
    </style>
  </head>

  <body>
    <!-- Skip links for keyboard navigation -->
    <a href="#main-content" class="skip-link" style="position:absolute; left:-9999px; z-index:999; padding:8px; background:var(--accent); color:var(--bg); text-decoration:none; border-radius:4px;">Aller au contenu principal</a>
    <a href="#selection-card" class="skip-link" style="position:absolute; left:-9999px; z-index:999; padding:8px; background:var(--accent); color:var(--bg); text-decoration:none; border-radius:4px;">Aller √† la s√©lection</a>
    
    <div class="wrap">
      <header class="topbar">
        <h1>Text2Quiz (Vite + TS)</h1>
        <div style="display:flex; gap:12px; align-items:center">
          <span id="total-time-badge" class="badge" style="display:none; font-size:13px; padding:6px 12px" title="Temps total pass√© √† r√©pondre aux questions">‚è±Ô∏è <span id="total-time-value">0h</span></span>
          <button id="btn-explorer" class="secondary" aria-haspopup="dialog" aria-expanded="false" aria-label="Explorer les fichiers de cours">Explorer les fichiers</button>
          <label class="theme-toggle" title="Basculer entre th√®me clair et sombre">
          <input id="theme-toggle" type="checkbox" aria-label="Basculer th√®me sombre" />
          <span aria-hidden="true">üåô</span>
          </label>
        </div>
      </header>

      <!-- Barre active en mode entra√Ænement/examen/flash/match -->
      <div id="active-toolbar" class="active-toolbar" style="display:none" role="region" aria-label="Barre d'outils session active">
        <div class="left">
          <span class="crumb" id="active-title">Mode</span>
        </div>
        <div class="right">
          <button id="btn-exit-mode" class="secondary" title="Quitter la session" aria-label="Quitter la session en cours">Quitter</button>
        </div>
      </div>

      <p class="subtitle">
        Entra√Ænement (correction imm√©diate + explication) ou Examen (correction √† la fin).
      </p>

  <main id="main-content">
  <div id="selection-area">
  <div class="card" id="selection-card">
        <div class="row">
          <label for="matiere">Mati√®re</label>
          <select id="matiere"></select>
        </div>

        <div class="card" id="plan-card" style="display:block; margin-top:4px">
          <div class="row">
            <label for="plan-filter">Plan du cours</label>
            <input id="plan-filter" type="text" placeholder="Rechercher un chapitre..."/>
          </div>
          <div id="plan-list" style="display:grid; gap:6px"></div>
        </div>

        <div class="card" id="global-stats-card" style="display:none; margin-top:4px">
          <h3 style="margin:4px 0">üìä Statistiques globales</h3>
          <div id="global-stats" class="folder-stats"></div>
        </div>

        <div class="card" id="folder-stats-card" style="display:none; margin-top:4px">
          <h3 style="margin:4px 0">Historique de la mati√®re</h3>
          <div id="folder-stats" class="folder-stats"></div>
        </div>

        <div class="card" id="course-stats-card" style="display:none; margin-top:4px">
          <h3 style="margin:4px 0">Statistiques du cours s√©lectionn√©</h3>
          <div id="course-stats" class="folder-stats"></div>
        </div>

        <div class="row">
          <label>
            <input type="checkbox" id="advanced-toggle" /> 
            Options avanc√©es
          </label>
        </div>

        <div class="row advanced" style="display:none">
          <label>
            <input type="checkbox" id="multi-cours-toggle" /> 
            R√©vision multi-cours
          </label>
        </div>

        <div class="row">
          <label for="cours">Cours</label>
          <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <select id="cours"></select>
            <button id="btn-download-selected" class="secondary" title="T√©l√©charger le cours s√©lectionn√©">T√©l√©charger</button>
          </div>
          <div id="cours-multi-checkboxes" style="display:none; max-height: 200px; overflow-y: auto; border: 1px solid var(--brd); border-radius: 8px; padding: 8px;">
            <div style="margin-bottom: 8px; font-size: 12px; color: var(--muted);">
              <label><input type="checkbox" id="select-all-cours" /> Tout s√©lectionner</label>
            </div>
            <div id="cours-checkbox-list"></div>
          </div>
        </div>

        <div class="row advanced" style="display:none">
          <label for="themes">Th√®mes (optionnel)</label>
          <select id="themes" multiple size="5" title="Ctrl/Cmd-clic pour multi-s√©lection"></select>
        </div>

        <div class="row">
          <label for="nombre">Nombre de questions</label>
          <input id="nombre" type="number" min="1" step="1" value="10"/>
        </div>

        <div class="row">
          <label>Mode</label>
          <div class="modes">
            <label><input type="radio" name="mode" value="entrainement" checked> Entra√Ænement</label>
            <label><input type="radio" name="mode" value="examen"> Examen</label>
            <label><input type="radio" name="mode" value="flashcards"> Flashcards</label>
            <label><input type="radio" name="mode" value="match"> Match (style Quizlet)</label>
          </div>
          <div id="match-mode-hint" class="subtitle" style="margin-top:4px"></div>
        </div>

        <div class="row advanced" style="display:none">
          <label>Types de questions (optionnel)</label>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <label><input type="checkbox" class="qtype" value="QCM" checked/> QCM</label>
            <label><input type="checkbox" class="qtype" value="QR" checked/> QR</label>
            <label><input type="checkbox" class="qtype" value="VF" checked/> VF</label>
            <label><input type="checkbox" class="qtype" value="DragMatch" checked/> DragMatch</label>
            <label><input type="checkbox" class="qtype" value="OpenQ" checked/> OpenQ</label>
          </div>
        </div>

        <button id="start" class="primary">Commencer</button>
      </div>
      </div>

  <div id="quiz-root"></div>
  </main>
    
    <!-- File browser modal (Windows-like explorer) -->
    <div id="file-browser" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:80;" role="dialog" aria-modal="true" aria-labelledby="fb-title">
      <div style="max-width:1000px; height:70vh; margin:40px auto; background:var(--bg); padding:8px; border-radius:8px; border:1px solid var(--brd); display:flex;">
        <div style="width:260px; border-right:1px solid var(--brd); padding:8px; overflow:auto">
          <h4 style="margin:6px 0" id="fb-title">Mati√®res</h4>
          <div id="fb-folders" role="list" aria-label="Liste des mati√®res"></div>
        </div>
        <div style="flex:1; padding:8px; overflow:auto; display:flex; flex-direction:column">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <h4 style="margin:6px 0">Cours</h4>
            <div><button id="fb-close" class="secondary" aria-label="Fermer l'explorateur de fichiers">Fermer</button></div>
          </div>
          <div id="fb-files" style="margin-top:8px; display:grid; gap:8px;" role="list" aria-label="Liste des cours"></div>
        </div>
      </div>
    </div>

    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
